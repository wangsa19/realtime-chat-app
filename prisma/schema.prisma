generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

enum MessageStatus {
    SENT
    DELIVERED
    READ
}

model User {
    id                  Int        @id @default(autoincrement())
    name                String?
    email               String     @unique
    phoneNumber         String?    @unique
    password            String
    sentMessages        Messages[] @relation("SenderRelation")
    receivedMessages    Messages[] @relation("ReceiverRelation")
    contactsAsRequester Contact[]  @relation("Requester")
    contactsAsAddressee Contact[]  @relation("Addressee")
}

model Contact {
    id          Int      @id @default(autoincrement())
    requesterId Int
    addresseeId Int
    createdAt   DateTime @default(now())

    requester User @relation("Requester", fields: [requesterId], references: [id], onDelete: Cascade, onUpdate: Cascade)
    addressee User @relation("Addressee", fields: [addresseeId], references: [id], onDelete: Cascade, onUpdate: Cascade)

    @@unique([requesterId, addresseeId])
}

model Messages {
    id           Int           @id @default(autoincrement())
    sender_id    Int
    userSender   User          @relation("SenderRelation", fields: [sender_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
    receiver_id  Int
    userReceiver User          @relation("ReceiverRelation", fields: [receiver_id], references: [id], onDelete: Cascade, onUpdate: Cascade)
    content      String
    status       MessageStatus @default(SENT)
    timestamp    DateTime
}
